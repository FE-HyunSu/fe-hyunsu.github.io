---
layout: post
title: "ğŸ¦“ KOA"
date: 2022-12-20
tags: [backend-study]
---

## ğŸŒ Hello Koa.

- Node.jsì˜ ì›¹ í”„ë ˆì„ì›Œí¬ì¸ Express.js ì˜ ê°œë°œíŒ€ì´, Koa ë¼ëŠ” ì›¹í”„ë ˆì„ì›Œí¬ë¥¼ ìƒˆë¡œ ë§Œë“¤ì—ˆìŒ.
- ê¸°ì¡´ì˜ Express ì˜ ê²½ìš°ì—” ì˜¤í”ˆì†ŒìŠ¤ì˜ ì†Œìœ ê¶Œì´ IBM ê³„ì—´ì‚¬ì¸ StrongLoop ìœ¼ë¡œ ì´ì „ì´ ë˜ì—ˆìœ¼ë©°, ìœ ì§€ë³´ìˆ˜ëŠ” ë˜ê³ ìˆê¸´ í•˜ì§€ë§Œ, ì¥ê¸°ì ìœ¼ë¡œ ë³´ë©´ ì´ë¡œ ì¸í•˜ì—¬ ì¸ì§€ë„ë¥¼ ìƒì„ í™•ë¥ ì´ ë†’ë‹¤ê³  í•¨.
- ë¬¼ë¡ , ExpressëŠ” ìœ ëª…í•œ ë¼ì´ë¸ŒëŸ¬ë¦¬ì´ê¸° ë•Œë¬¸ì—, ë§¤ìš° ë§ì€ í”„ë¡œì íŠ¸ì—ì„œ Express ë¥¼ ì‚¬ìš©í•˜ê³  ìˆê¸´ í•¨.
- í•˜ì§€ë§Œ, Koa ë¡œ ë§ˆì´ê·¸ë ˆì´ì…˜ í•˜ëŠ” í”„ë¡œì íŠ¸ë„ ëŠ˜ì–´ë‚˜ëŠ” ì¶”ì„¸.
- Koaì˜ ì¥ì ìœ¼ë¡  Expressë³´ë‹¤ í›¨ì”¬ ê°€ë³ê³ , Node.js v7 ì˜ async/await ê¸°ëŠ¥ì„ ì•„ì£¼ í¸í•˜ê²Œ ì‚¬ìš© í•  ìˆ˜ ìˆë‹¤ëŠ” ì .

<br/>

## ğŸ¦Ÿ Koaì— ëŒ€í•´ ì¢€ë” ì•Œì•„ë³´ì.

- Koa ì–´í”Œë¦¬ì¼€ì´ì…˜ì€, ë¯¸ë“¤ì›¨ì–´ì˜ ë°°ì—´ë¡œ êµ¬ì„±ë¨.
- app.use ë¼ëŠ” í•¨ìˆ˜ë¥¼ í†µí•´ ë¯¸ë“¤ì›¨ì–´ë¥¼ ì–´í”Œë¦¬ì¼€ì´ì…˜ì— ë“±ë¡ í•¨.

```js
const Koa = require("koa"); // Node.JS ì—ì„œëŠ” require ë©”ì„œë“œë¥¼ í†µí•´ ì™¸ë¶€ ëª¨ë“ˆì„ ê°€ì ¸ì˜¬ ìˆ˜ ìˆìŒ.
const app = new Koa();

app.use((ctx) => {
  ctx.body = "Hello Koa";
});

app.listen(4000, () => {
  console.log("heurm server is listening to port 4000");
});
```

- ì—¬ê¸°ì„œ ctx => { ... } ì½”ë“œê°€, í•˜ë‚˜ì˜ ë¯¸ë“¤ì›¨ì–´ ì¸ ê²ƒ.
- koa ì˜ ë¯¸ë“¤ì›¨ì–´í•¨ìˆ˜ì—ì„ , ë‘ê°€ì§€ì˜ íŒŒë¼ë¯¸í„°ë¥¼ ë°›ëŠ”ë‹¤.
- ctx : ì›¹ ìš”ì²­ê³¼, ì‘ë‹µì— ëŒ€í•œ ì •ë³´ë¥¼ ì§€ë‹ˆê³ ìˆìŒ.
- next : ë‹¤ìŒ ë¯¸ë“¤ì›¨ì–´ë¥¼ ì‹¤í–‰ì‹œí‚¤ëŠ” í•¨ìˆ˜. (ë§Œì•½ ë¯¸ë“¤ì›¨ì–´ì—ì„œ next í˜¸ì¶œí•˜ì§€ ì•Šê²Œ ëœë‹¤ë©´, ê·¸ ë¶€ë¶„ì—ì„œ ìš”ì²­ì²˜ë¦¬ë¥¼ ì™„ë£Œì‹œí‚¤ê³ , ì‘ë‹µì„ í•˜ê²Œë¨.)

```js
app.use((ctx, next) => {
  console.log(1);
  next();
});
app.use((ctx, next) => {
  console.log(2);
  next();
});
```

- next() ë©”ì„œë“œëŠ” Promiseë¥¼ ë°˜í™˜í•œë‹¤.
- ì•„ë˜ì™€ ê°™ì€ í˜•ì‹ìœ¼ë¡œ thanì„ í†µí•´, ë‹¤ìŒ ì‘ì—…ë“¤ì— ëŒ€í•œ ë‚´ìš©ì„ ì •ì˜í•  ìˆ˜ ìˆìŒ.

```js
app.use((ctx, next) => {
  console.log(1);
  const started = new Date();
  next().then(() => {
    console.log(new Date() - started + "ms");
  });
});
```

<br/>

## ğŸ… koa-router.

- koa ëª¨ë“ˆì— routerê°€ ë‚´ì¥ë˜ì–´ ìˆì§„ ì•Šë‹¤.
- koa-router ëª¨ë“ˆ ì¶”ê°€ ì„¤ì¹˜ê°€ í•„ìš”.

```js
// src/index.js
const Koa = require("koa");
const Router = require("koa-router");

const app = new Koa();
const router = new Router(); // Router ì¸ìŠ¤í„´ìŠ¤ë¥¼ ìƒˆë¡œ ìƒì„±í•˜ì—¬ router ê°’ì— ë„£ê³ ,

// '/' ê²½ë¡œë¡œ ë“¤ì–´ì˜¤ë©´ í™ˆ ì´ë¼ëŠ” ë‚´ìš©ìœ¼ë¡œ ì‘ë‹µí•˜ë„ë¡ ë¼ìš°í„° ì„¤ì •.
router.get("/", (ctx, next) => {
  ctx.body = "í™ˆ";
});

app.use(router.routes());
app.use(router.allowedMethods());

app.listen(4000, () => {
  console.log("heurm server is listening to port 4000");
});
```

- Router ì¸ìŠ¤í„´ìŠ¤ë¥¼ ìƒˆë¡œ ìƒì„±í•˜ì—¬ router ê°’ì— ë„£ê³ , '/' ê²½ë¡œë¡œ ë“¤ì–´ì˜¤ë©´ í™ˆ ì´ë¼ëŠ” ë‚´ìš©ìœ¼ë¡œ ì‘ë‹µí•˜ë„ë¡ ë¼ìš°í„° ì„¤ì •.

<br/>

## ğŸ¡ HTTP method ì‚¬ìš©.

- REST API ì—ì„œ, ìš”ì²­ì˜ ì¢…ë¥˜ì— ë”°ë¼ ë‹¤ë¥¸ HTTP ë©”ì†Œë“œë¥¼ ì‚¬ìš©. (GET/POST/DELETE/PUT/PATCH)

```js
// src/books/index.js
const Router = require("koa-router");
const books = new Router();
const handler = (ctx, next) => {
  ctx.body = `${ctx.request.method} ${ctx.request.path}`;
};
books.get("/", handler);
books.post("/", handler);
books.delete("/", handler);
books.put("/", handler);
books.patch("/", handler);

module.exports = books;
```

<br/>

---

<br/>

## ğŸ« ì°¸ê³  í˜ì´ì§€

- [https://www.youtube.com/watch?v=9wrHxqI6zuM](https://www.youtube.com/watch?v=9wrHxqI6zuM){:target="\_blank"}
  <br/><br/>

---
